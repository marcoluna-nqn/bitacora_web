<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="Bit√°cora Web ‚Äî hoja tipo Excel con exportaci√≥n XLSX." />
  <meta name="theme-color" content="#0A84FF" />
  <meta name="color-scheme" content="light dark" />

  <!-- PWA / iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Bit√°cora Web" />
  <link rel="apple-touch-icon" href="icons/Icon-192.png" />

  <!-- PWA / Android -->
  <meta name="mobile-web-app-capable" content="yes" />

  <!-- Importante para GitHub Pages -->
  <base href="/bitacora_web/" />

  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/png" href="favicon.png" />
  <title>Bit√°cora Web</title>

  <!-- Google Identity Services: pon√© tu Client ID ac√° o us√° ?gid= en pruebas -->
  <meta name="google-signin-client_id" content="">
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- Anti-cache: desregistrar SW viejos + limpiar caches ANTES de bootstrap -->
  <script defer>
    (function () {
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations()
          .then(rs => Promise.all(rs.map(r => r.unregister()))).catch(() => {});
      }
      if (window.caches?.keys) {
        caches.keys().then(keys => Promise.all(keys.map(k => caches.delete(k)))).catch(() => {});
      }
    })();
  </script>

  <!-- Preloads livianos -->
  <link rel="preload" href="flutter_bootstrap.js" as="script" />
  <link rel="preload" href="assets/sfx/type.wav" as="audio" />

  <!-- Estilos propios -->
  <link rel="stylesheet" href="interop.css" />

  <!-- Estilos m√≠nimos para la barra de sesi√≥n -->
  <style>
    #authBar{
      position: fixed; inset: 0 0 auto 0; height: 44px;
      display: flex; align-items: center; gap: .5rem;
      padding: 6px 10px; background: color-mix(in srgb, Canvas 92%, transparent);
      backdrop-filter: saturate(1.1) blur(6px);
      border-bottom: 1px solid color-mix(in srgb, CanvasText 10%, transparent);
      z-index: 9999; user-select: none;
    }
    #authSpacer{ flex: 1 }
    #g-btn{ min-height: 40px }
    .avatar{ width: 28px; height: 28px; border-radius: 50% }
    .user{ line-height: 1; font-size: 13px }
    .user small{ color: #6b7280 }
    .btn{ border: 1px solid #111; padding: .35rem .7rem; border-radius: 9999px; background: #fff; cursor: pointer }
    @media (prefers-color-scheme: dark){
      .btn{ background:#0b0b0c; color:#fafafa; border-color:#3a3a3a }
      .user small{ color:#9ca3af }
    }
    body{ padding-top: 44px } /* evita solapar la UI de Flutter con la barra */
  </style>
</head>
<body>
<noscript>Habilit√° JavaScript para usar esta app.</noscript>

<!-- Barra de autenticaci√≥n -->
<header id="authBar" aria-label="Barra de sesi√≥n">
  <div class="brand" style="font-weight:600">Bit√°cora Web</div>
  <div id="authStatus" class="user" style="display:none"></div>
  <div id="authSpacer"></div>
  <div id="g-btn" aria-live="polite"></div>
</header>

<!-- Bootstrap de Flutter -->
<script src="flutter_bootstrap.js" defer></script>

<!-- Botones flotantes (arrastrables) -->
<button id="gpsFab" class="fab" title="Ubicaci√≥n" aria-label="Ubicaci√≥n">üìç</button>
<button id="micFab" class="fab fab-left" title="Dictado" aria-label="Dictado">üéôÔ∏è</button>

<!-- Sonido de tipeo -->
<audio id="typeSfx" src="assets/sfx/type.wav" preload="auto"></audio>

<!-- Interop con Web APIs -->
<script type="module" defer src="interop.js"></script>

<!-- Login Google listo -->
<script type="module" defer src="auth.js"></script>
</body>
</html>
